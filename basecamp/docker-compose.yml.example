version: "2"

volumes:
    postgres-data:
        driver: local

services:
    application:
        container_name: basecamp-costlocker
        build:
            context: .
            dockerfile: ./.docker/Dockerfile
        ports:
            - "19997:80"
        volumes:
            - "./backend/var/sessions:/app/backend/var/sessions"
            - "./backend/var/log:/app/backend/var/log"
        links:
            - postgres:db.local

    queue_daemon:
        container_name: basecamp-costlocker-queue
        restart: always
        build:
            context: .
            dockerfile: ./.docker/Dockerfile.queue
        links:
            - postgres:db.local

    postgres:
        image: postgres:9.6.3
        restart: always
        volumes:
            - postgres-data:/var/lib/postgresql/data
        environment:
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
